<% page_title(@user.name) %>

<ol class="breadcrumb mb-5">
  <li class="breadcrumb-item"><%= link_to t('admin.header'), admin_root_path %></li>
  <li class="breadcrumb-item"><%= link_to t('admin.users.index.header'), admin_users_path %></li>
  <li class="breadcrumb-item active"><%=@user.email %></li>
</ol>

<div class="d-flex flex-wrap justify-content-between mb-3">
  <h1><%= @user.name %></h1>

  <div class="align-self-center">
    <% if policy([:admin, @user]).suspend? %>
      <%= link_to(suspend_admin_user_path(@user), method: :patch,
        class: 'btn btn-secondary',
        data: { confirm: t('.suspend_dialog', user: @user.name) }) do %>
        <%= fa_icon 'ban' %>
        <%= t('.suspend_link_text') %>
      <% end %>
    <% end %>

    <% if policy([:admin, @user]).unsuspend? %>
      <%= link_to(unsuspend_admin_user_path(@user), method: :patch,
        class: 'btn btn-secondary',
        data: { confirm: t('.unsuspend_dialog', user: @user.name) }) do %>
        <%= fa_icon 'check-circle' %>
        <%= t('.unsuspend_link_text') %>
      <% end %>
    <% end %>

    <% if policy([:admin, @user]).revoke_admin? %>
      <%= link_to(revoke_admin_admin_user_path(@user), method: :patch,
        class: 'btn btn-secondary',
        data: { confirm: t('.revoke_admin_dialog', user: @user.name) }) do %>
        <%= fa_icon 'minus-circle' %>
        <%= t('.revoke_admin_link_text') %>
      <% end %>
    <% end %>

    <% if policy([:admin, @user]).grant_admin? %>
      <%= link_to(grant_admin_admin_user_path(@user), method: :patch,
        class: 'btn btn-secondary',
        data: { confirm: t('.grant_admin_dialog', user: @user.name) }) do %>
        <%= fa_icon 'shield' %>
        <%= t('.grant_admin_link_text') %>
      <% end %>
    <% end %>

    <% if policy([:admin, @user]).impersonate? %>
      <%= link_to(impersonate_admin_user_path(@user), method: :post,
        class: 'btn btn-secondary',
        data: { confirm: t('.impersonate_dialog', user: @user.name) }) do %>
        <%= fa_icon 'user-secret' %>
        <%= t('.impersonate_link_text') %>
      <% end %>
    <% end %>
  </div>
</div>

<dl class="row">
  <dt class="col-sm-3"><%= t('.email')%></dt>
  <dd class="col-sm-9">
    <%= @user.email %>
  </dd>

  <dt class="col-sm-3"><%= t('admin.users.index.role') %></dt>
  <dd class="col-sm-9">
    <%= user_role(@user) %>
  </dd>

  <dt class="col-sm-3"><%= t('admin.users.index.status') %></dt>
  <dd class="col-sm-9">
    <%= user_status(@user) %>
  </dd>

  <dt class="col-sm-3"><%= t('admin.users.index.created') %></dt>
  <dd class="col-sm-9">
    <%= time_tag @user.created_at, format: '%F' %>
  </dd>

  <dt class="col-sm-3"><%= t('admin.users.index.updated') %></dt>
  <dd class="col-sm-9">
    <%= time_tag @user.updated_at, format: '%F' %>
  </dd>
</dl>



<div class="row my-5">
  <div class="col-md-12">

    <div class="d-flex justify-content-between mb-3">
      <h2><%= t('.user_items') %></h2>
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle"
        type="button"
        id="sortItemsDropdown"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false">
          <%= t('.sort') %>
        </button>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="sortItemsDropdown">
          <h6 class="dropdown-header"><%= t('.sort_by') %></h6>
          <%= items_sort_link 'record_created_at', 'desc', t('.latest') %>
          <%= items_sort_link 'record_created_at', 'asc', t('.oldest') %>
          <%= items_sort_link 'title', 'asc', t('.title_asc') %>
          <%= items_sort_link 'title', 'desc', t('.title_desc') %>
        </div>
      </div>
    </div>

    <p class="text-center"><%= t('.display_items_count', items_count: @items.count, total_items_count: @user.items.count) %></p>
    <div class="list-group mb-3">
      <% if @items.present? %>
        <%# TODO: FIX links when item CRUD is completed %>
        <% @items.each do |item| %>
          <div class='list-group-item list-group-item-action d-flex justify-content-between align-items-start'>
            <%= link_to item.title, item_path(item) %>
            <%= link_to edit_item_path(item), class: 'btn btn-secondary' do %>
              <%= fa_icon 'pencil-square-o' %>
              <%= t('edit') %>
              <% end %>
          </div>
        <% end %>
      <% else %>
        <div class='list-group-item'>
          <%= t('.no_items_found') %>
        </div>
      <% end %>
    </div>
    <%= paginate @items %>
  </div>
</div>
