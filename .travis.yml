sudo: required

language: bash
services: docker

before_script:
  - docker version
  - docker-compose version

  - docker-compose build web
  - docker-compose up -d web

  - sleep 10 # wait for containers to finish setting up
  - docker ps

  - docker-compose run --rm -e RAILS_ENV=test web rails db:create

  - sleep 5 # wait for database to finish setting up

  - docker-compose run --rm -e RAILS_ENV=test web rails db:migrate

script:
  - docker-compose run --rm -e RAILS_ENV=test web rails test
  - docker-compose run --rm -e RAILS_ENV=test web rails test:system
  - docker-compose run --rm web rubocop
  - docker-compose run --rm web scss-lint

# after_success:
 # Do autodeploy magic here to UAT
  # - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  # - docker push $REPO
  # - bash deploy.sh
